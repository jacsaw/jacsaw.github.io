<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CTC Policy Simulator - AI-Powered</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: #1e3a8a;
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.95;
            font-size: 16px;
            line-height: 1.6;
        }

        .mode-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .mode-button {
            flex: 1;
            padding: 20px;
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .mode-button:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .mode-button.active {
            background: #dbeafe;
            border-color: #2563eb;
        }

        .mode-button h3 {
            color: #1e3a8a;
            margin-bottom: 8px;
            font-size: 18px;
        }

        .mode-button p {
            color: #6b7280;
            font-size: 14px;
            line-height: 1.5;
        }

        .mode-button.active p {
            color: #1e40af;
        }

        .context-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #2563eb;
        }

        .context-card h3 {
            color: #1e3a8a;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .context-card p {
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .context-card strong {
            color: #1f2937;
        }

        .show-structure-btn {
            margin-top: 20px;
            padding: 12px 24px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            justify-content: center;
        }

        .show-structure-btn:hover {
            background: #1d4ed8;
        }

        #structureBtnIcon {
            transition: transform 0.3s;
            font-size: 12px;
        }

        .show-structure-btn.open #structureBtnIcon {
            transform: rotate(180deg);
        }

        .credit-structure-section {
            background: white;
            padding: 0;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.5s ease-out, padding 0.3s ease-out;
        }

        .credit-structure-section.hidden {
            max-height: 0;
            padding: 0;
        }

        .credit-structure-section.visible {
            max-height: 3000px;
            padding: 30px;
        }

        .structure-content h2 {
            color: #1e3a8a;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .components-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .component-card {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #2563eb;
        }

        .component-card h4 {
            color: #1e3a8a;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .component-card .value {
            font-size: 26px;
            font-weight: bold;
            color: #2563eb;
            margin-bottom: 8px;
        }

        .component-card .description {
            color: #4b5563;
            line-height: 1.5;
            font-size: 13px;
        }

        .filing-status-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .tab-button {
            flex: 1;
            padding: 12px;
            background: #f3f4f6;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: #6b7280;
        }

        .tab-button.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .tab-button:hover:not(.active) {
            background: #e5e7eb;
        }

        .graph-container {
            position: relative;
            margin: 20px 0;
        }

        svg {
            width: 100%;
            height: 400px;
            overflow: visible;
        }

        .legend {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 30px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-label {
            font-size: 14px;
            color: #4b5563;
            font-weight: 500;
        }

        .explanation-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .explanation-table th {
            background: #f9fafb;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            font-size: 14px;
        }

        .explanation-table td {
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 14px;
        }

        .explanation-table tr:hover {
            background: #f9fafb;
        }

        .zone-name {
            font-weight: 600;
            color: #1e3a8a;
        }

        .axis-label {
            font-size: 14px;
            fill: #6b7280;
            font-weight: 500;
        }

        .axis-title {
            font-size: 16px;
            fill: #1f2937;
            font-weight: 600;
        }

        .phase-in-zone {
            fill: #dbeafe;
            opacity: 0.5;
        }

        .max-credit-zone {
            fill: #dcfce7;
            opacity: 0.5;
        }

        .phase-out-zone {
            fill: #fef3c7;
            opacity: 0.5;
        }

        .credit-line {
            stroke: #2563eb;
            stroke-width: 3;
            fill: none;
        }

        .goal-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .goal-card {
            padding: 20px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .goal-card:hover {
            border-color: #93c5fd;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
        }

        .goal-card.selected {
            background: #dbeafe;
            border-color: #2563eb;
        }

        .goal-card .checkbox {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 24px;
            height: 24px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            background: white;
            transition: all 0.3s;
        }

        .goal-card.selected .checkbox {
            background: #2563eb;
            border-color: #2563eb;
        }

        .goal-card.selected .checkbox::after {
            content: "✓";
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .build-action-bar {
            display: flex;
            gap: 15px;
            align-items: center;
            padding: 20px;
            background: #f9fafb;
            border-radius: 12px;
            margin-top: 20px;
        }

        .selected-count {
            flex: 1;
            color: #4b5563;
            font-weight: 500;
        }

        .build-policy-btn {
            padding: 15px 30px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .build-policy-btn:hover {
            background: #1d4ed8;
        }

        .build-policy-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .clear-selections-btn {
            padding: 15px 30px;
            background: white;
            color: #6b7280;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .clear-selections-btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        .strength-indicator {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .strength-indicator h3 {
            margin-bottom: 10px;
            font-size: 18px;
        }

        .strength-indicator p {
            opacity: 0.95;
            line-height: 1.5;
        }

        .combined-goals-list {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
        }

        .combined-goals-list h3 {
            color: #1e40af;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .combined-goals-list ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .combined-goals-list li {
            padding: 8px 0;
            color: #1e40af;
            font-weight: 500;
        }

        .combined-goals-list li:before {
            content: "✓ ";
            color: #3b82f6;
            font-weight: bold;
            margin-right: 8px;
        }

        .query-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .query-section h2 {
            color: #1e3a8a;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .input-wrapper {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .query-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .query-input:focus {
            outline: none;
            border-color: #2563eb;
        }

        .analyze-btn {
            padding: 15px 30px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .analyze-btn:hover {
            background: #1d4ed8;
        }

        .analyze-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .example-queries {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .scenario-card {
            padding: 20px;
            background: #f0f9ff;
            border: 2px solid #bfdbfe;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .scenario-card:hover {
            background: #e0f2fe;
            border-color: #60a5fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
        }

        .scenario-title {
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .scenario-description {
            font-size: 14px;
            color: #1e40af;
            line-height: 1.5;
        }

        .example-tag {
            padding: 8px 16px;
            background: #eff6ff;
            color: #1e40af;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
        }

        .example-tag:hover {
            background: #dbeafe;
            transform: translateY(-2px);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #2563eb;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .interpretation {
            background: #f0fdf4;
            border-left: 4px solid #22c55e;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
        }

        .interpretation h3 {
            color: #166534;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .interpretation p {
            color: #15803d;
            line-height: 1.6;
            font-size: 15px;
        }

        .impact-preview {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
        }

        .impact-preview h3 {
            color: #1e40af;
            margin-bottom: 12px;
            font-size: 18px;
        }

        .impact-item {
            display: flex;
            align-items: start;
            margin-bottom: 10px;
            color: #1e40af;
        }

        .impact-item:last-child {
            margin-bottom: 0;
        }

        .impact-icon {
            font-size: 20px;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .impact-text {
            line-height: 1.5;
            font-size: 15px;
        }

        .toggle-section {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .toggle-button {
            padding: 10px 20px;
            background: #f3f4f6;
            color: #4b5563;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle-button.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .toggle-button:hover:not(.active) {
            background: #e5e7eb;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th {
            background: #f9fafb;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            font-size: 14px;
        }

        .comparison-table td {
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 15px;
        }

        .comparison-table tr:hover {
            background: #f9fafb;
        }

        .lever-name {
            font-weight: 500;
            color: #1f2937;
        }

        .lever-description {
            font-size: 13px;
            color: #6b7280;
            margin-top: 4px;
            font-weight: 400;
        }

        .changed {
            background: #fef3c7 !important;
        }

        .change-indicator {
            display: inline-block;
            padding: 4px 12px;
            background: #fbbf24;
            color: #78350f;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .value-current {
            color: #6b7280;
        }

        .value-new {
            color: #2563eb;
            font-weight: 600;
        }

        .changed-levers-summary {
            background: #fef3c7;
            border-left: 4px solid #fbbf24;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
        }

        .changed-levers-summary h3 {
            color: #78350f;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .changed-levers-summary p {
            color: #92400e;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .changed-levers-list {
            list-style: none;
            margin-top: 10px;
        }

        .changed-levers-list li {
            padding: 10px;
            margin-bottom: 8px;
            color: #78350f;
            font-weight: 500;
            background: white;
            border-radius: 6px;
            font-size: 15px;
        }

        .changed-levers-list li:last-child {
            margin-bottom: 0;
        }

        .changed-levers-list .lever-label {
            font-weight: 600;
            color: #92400e;
        }

        .changed-levers-list .lever-change {
            color: #78350f;
            font-weight: 400;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Child Tax Credit: Explore Policy Options</h1>
            <p>The Child Tax Credit helps millions of families with the cost of raising children. Tell us what outcome you'd like to see, and we'll show you how the policy could be adjusted to achieve it.</p>
        </div>

        <div class="context-card">
            <h3>What is the Child Tax Credit?</h3>
            <p>The Child Tax Credit (CTC) is a benefit that reduces taxes for families raising children. <strong>For the 2026 fiscal year</strong> (following the One Big Beautiful Bill Act passed in 2025):</p>
            <p><strong>→ Families receive up to $2,200 per child</strong> under age 17 (increased from $2,000)</p>
            <p><strong>→ Up to $1,700 is refundable</strong> (you can get it even if you don't owe taxes)</p>
            <p><strong>→ Benefits phase out</strong> for higher earners ($200K+ for single parents, $400K+ for married couples)</p>
            <p><strong>→ Both parent and child must have valid Social Security Numbers</strong> to qualify (new requirement)</p>
            <p><strong>→ Credit amount will now adjust for inflation each year</strong> starting in 2026 (permanent change)</p>
            
            <button class="show-structure-btn" onclick="toggleCreditStructure()">
                <span id="structureBtnText">See What the Credit Looks Like in Current Practice</span>
                <span id="structureBtnIcon">▼</span>
            </button>
        </div>

        <div id="creditStructureSection" class="credit-structure-section hidden">
            <div class="structure-content">
                <h2>Child Tax Credit Structure (2026)</h2>
                <p style="color: #6b7280; margin-bottom: 30px;">Understanding how the credit amount changes based on family income</p>

                <h3 style="color: #1e3a8a; margin-bottom: 20px; font-size: 20px;">Key Components of the Credit</h3>
                <div class="components-grid">
                    <div class="component-card">
                        <h4>Maximum Credit</h4>
                        <div class="value">$2,200</div>
                        <div class="description">The most you can receive per child once you reach a certain income level</div>
                    </div>

                    <div class="component-card">
                        <h4>Phase-In Rate</h4>
                        <div class="value">15%</div>
                        <div class="description">How quickly your credit grows as your income increases (for lower earners)</div>
                    </div>

                    <div class="component-card">
                        <h4>Minimum Earnings</h4>
                        <div class="value">$2,500</div>
                        <div class="description">The minimum income required to start receiving any credit</div>
                    </div>

                    <div class="component-card">
                        <h4>Phase-Out Rate</h4>
                        <div class="value">5%</div>
                        <div class="description">How quickly your credit decreases once you reach the phase-out threshold</div>
                    </div>

                    <div class="component-card">
                        <h4>Single Filer Threshold</h4>
                        <div class="value">$200,000</div>
                        <div class="description">Income level where the credit starts to phase out for single parents</div>
                    </div>

                    <div class="component-card">
                        <h4>Married Joint Threshold</h4>
                        <div class="value">$400,000</div>
                        <div class="description">Income level where the credit starts to phase out for married couples</div>
                    </div>
                </div>

                <h3 style="color: #1e3a8a; margin: 40px 0 20px 0; font-size: 20px;">How Your Credit Changes with Income</h3>
                
                <div class="filing-status-tabs">
                    <button class="tab-button active" onclick="showFilingStatus('single')">
                        Single / Head of Household
                    </button>
                    <button class="tab-button" onclick="showFilingStatus('married')">
                        Married Filing Jointly
                    </button>
                </div>

                <div class="graph-container">
                    <svg id="creditGraph" viewBox="0 0 1000 400"></svg>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #dbeafe;"></div>
                        <span class="legend-label">Phase-In Zone</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #dcfce7;"></div>
                        <span class="legend-label">Maximum Credit Zone</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #fef3c7;"></div>
                        <span class="legend-label">Phase-Out Zone</span>
                    </div>
                </div>

                <h3 style="color: #1e3a8a; margin: 40px 0 20px 0; font-size: 20px;">Understanding Each Zone</h3>
                <table class="explanation-table">
                    <thead>
                        <tr>
                            <th style="width: 25%;">Zone</th>
                            <th style="width: 35%;">What's Happening</th>
                            <th style="width: 40%;">Example</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="zone-name">Phase-In Zone</span></td>
                            <td>Your credit increases by 15% of earnings above $2,500 until you reach the maximum credit of $2,200</td>
                            <td>A family earning $10,000 would receive: ($10,000 - $2,500) × 15% = <strong>$1,125</strong></td>
                        </tr>
                        <tr>
                            <td><span class="zone-name">Maximum Credit Zone</span></td>
                            <td>You receive the full $2,200 per child. Your credit stays at this amount regardless of income increases</td>
                            <td>A single parent earning $50,000 receives the full <strong>$2,200</strong> per child</td>
                        </tr>
                        <tr>
                            <td><span class="zone-name">Phase-Out Zone</span></td>
                            <td>Your credit decreases by $50 for every $1,000 earned above the threshold (5% rate)</td>
                            <td>A single parent earning $210,000 would lose: ($210,000 - $200,000) ÷ 1,000 × $50 = <strong>$500</strong>, receiving $1,700 instead of $2,200</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="mode-selector">
            <div class="mode-button active" id="singleGoalMode" onclick="switchMode('single')">
                <h3>Single Goal</h3>
                <p>Explore one policy change at a time</p>
            </div>
            <div class="mode-button" id="comprehensiveMode" onclick="switchMode('comprehensive')">
                <h3>Build Comprehensive Policy</h3>
                <p>Select multiple goals and see the strongest combined proposal</p>
            </div>
        </div>

        <div id="singleModeSection" class="query-section">
            <h2>What would you like to accomplish?</h2>
            <p style="color: #6b7280; margin-bottom: 20px;">Choose a scenario below or describe your own goal in plain language</p>
            
            <div class="example-queries">
                <div class="scenario-card" data-query="Help families with babies by providing an extra $1,000 for infants under 1 year old">
                    <div class="scenario-title">Support families with newborns</div>
                    <div class="scenario-description">Provide extra help during the expensive first year</div>
                </div>
                
                <div class="scenario-card" data-query="Increase the credit to $3,000 to help families keep up with rising costs">
                    <div class="scenario-title">Increase support for all families</div>
                    <div class="scenario-description">Raise the base credit to match inflation</div>
                </div>
                
                <div class="scenario-card" data-query="Make the full credit available to low-income families even if they don't earn much">
                    <div class="scenario-title">Help lowest-income families</div>
                    <div class="scenario-description">Remove earnings requirements for access</div>
                </div>
                
                <div class="scenario-card" data-query="Give working parents more of the credit upfront instead of waiting for tax time">
                    <div class="scenario-title">Improve monthly cash flow</div>
                    <div class="scenario-description">Help families budget throughout the year</div>
                </div>
                
                <div class="scenario-card" data-query="Provide extra support of $600 for families with young children under age 6">
                    <div class="scenario-title">Help with early childhood costs</div>
                    <div class="scenario-description">Offset childcare and preschool expenses</div>
                </div>
                
                <div class="scenario-card" data-query="Allow families with 17-year-olds to receive the credit since high schoolers are expensive">
                    <div class="scenario-title">Cover older teens</div>
                    <div class="scenario-description">Extend benefits through high school</div>
                </div>
            </div>

            <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e5e7eb;">
                <h3 style="color: #1e3a8a; margin-bottom: 15px; font-size: 18px;">Or describe your own idea:</h3>
                <div class="input-wrapper">
                    <input 
                        type="text" 
                        class="query-input" 
                        id="policyQuery"
                        placeholder="e.g., Help middle-class families who are struggling with costs..."
                    />
                    <button class="analyze-btn" id="analyzeBtn">See Changes</button>
                </div>
            </div>
        </div>

        <div id="comprehensiveModeSection" class="query-section hidden">
            <h2>Select All Goals You Want to Achieve</h2>
            <p style="color: #6b7280; margin-bottom: 20px;">Choose all the outcomes you'd like to see. We'll create the strongest policy that accomplishes all of them together.</p>
            
            <div class="goal-selection-grid">
                <div class="goal-card" data-goal="newborns" onclick="toggleGoal(this)">
                    <div class="checkbox"></div>
                    <div class="scenario-title">Support families with newborns</div>
                    <div class="scenario-description">Extra help during the expensive first year</div>
                </div>
                
                <div class="goal-card" data-goal="increase-base" onclick="toggleGoal(this)">
                    <div class="checkbox"></div>
                    <div class="scenario-title">Increase support for all families</div>
                    <div class="scenario-description">Raise the base credit amount</div>
                </div>
                
                <div class="goal-card" data-goal="low-income" onclick="toggleGoal(this)">
                    <div class="checkbox"></div>
                    <div class="scenario-title">Help lowest-income families</div>
                    <div class="scenario-description">Make fully refundable & remove earnings requirements</div>
                </div>
                
                <div class="goal-card" data-goal="young-children" onclick="toggleGoal(this)">
                    <div class="checkbox"></div>
                    <div class="scenario-title">Help with early childhood costs</div>
                    <div class="scenario-description">Extra support for children under 6</div>
                </div>
                
                <div class="goal-card" data-goal="seventeen" onclick="toggleGoal(this)">
                    <div class="checkbox"></div>
                    <div class="scenario-title">Cover older teens</div>
                    <div class="scenario-description">Extend benefits to 17-year-olds</div>
                </div>

                <div class="goal-card" data-goal="middle-class" onclick="toggleGoal(this)">
                    <div class="checkbox"></div>
                    <div class="scenario-title">Target middle-class families</div>
                    <div class="scenario-description">Adjust phase-out thresholds to focus on working families</div>
                </div>
            </div>

            <div class="build-action-bar">
                <div class="selected-count">
                    <span id="selectedCount">0</span> goals selected
                </div>
                <button class="clear-selections-btn" onclick="clearAllSelections()">Clear All</button>
                <button class="build-policy-btn" id="buildPolicyBtn" onclick="buildComprehensivePolicy()" disabled>
                    Build Comprehensive Policy
                </button>
            </div>

            <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e5e7eb;">
                <h3 style="color: #1e3a8a; margin-bottom: 15px; font-size: 18px;">Or describe your own comprehensive goal:</h3>
                <div class="input-wrapper">
                    <input 
                        type="text" 
                        class="query-input" 
                        id="comprehensiveQuery"
                        placeholder="e.g., Create a policy that helps both working-class and middle-class families..."
                    />
                    <button class="analyze-btn" onclick="analyzeComprehensiveCustom()">See Changes</button>
                </div>
            </div>
        </div>

        <div id="loadingSection" class="loading hidden">
            <div class="spinner"></div>
            <p>Analyzing your goal and figuring out how to make it happen...</p>
        </div>

        <div id="resultsSection" class="results-section hidden">
            <div class="strength-indicator" id="strengthIndicator">
                <h3>Comprehensive Policy Strength</h3>
                <p id="strengthText"></p>
            </div>

            <div class="combined-goals-list" id="combinedGoalsSection">
                <h3>Goals Achieved by This Policy</h3>
                <ul id="combinedGoalsList"></ul>
            </div>

            <div class="interpretation">
                <h3>What This Does</h3>
                <p id="interpretationText"></p>
            </div>

            <div class="impact-preview" id="impactSection">
                <h3>Who This Helps</h3>
                <div id="impactList"></div>
            </div>

            <div class="changed-levers-summary">
                <h3>Policy Changes (<span id="changedCount">0</span> adjustments)</h3>
                <p>Here are the specific policy adjustments needed to achieve this goal:</p>
                <ul class="changed-levers-list" id="changedLeversList"></ul>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: #1e3a8a; margin: 0;">Detailed Comparison</h2>
                <div class="toggle-section">
                    <button class="toggle-button active" id="changesOnlyBtn" onclick="toggleView(true)">
                        Show Changes Only
                    </button>
                    <button class="toggle-button" id="allLeversBtn" onclick="toggleView(false)">
                        Show All Parameters
                    </button>
                </div>
            </div>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th style="width: 40%;">Policy Parameter</th>
                        <th style="width: 25%;">Current Policy</th>
                        <th style="width: 35%;">Your Proposal</th>
                    </tr>
                </thead>
                <tbody id="comparisonTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const policyLevers = [
            { 
                name: "Maximum Base Credit Value", 
                description: "The maximum amount each family can receive per child",
                current: "$2,200", 
                key: "maxCredit" 
            },
            { 
                name: "Minimum Base Credit Value Enabled", 
                description: "Whether there's a guaranteed minimum credit amount",
                current: "No", 
                key: "minCreditEnabled" 
            },
            { 
                name: "Minimum Base Credit Value", 
                description: "The guaranteed minimum families receive",
                current: "N/A", 
                key: "minCredit" 
            },
            { 
                name: "Maximum Refundable Portion of the Credit", 
                description: "How much families can get back even if they don't owe taxes",
                current: "$1,700", 
                key: "maxRefundable" 
            },
            { 
                name: "Include 17-Year-Olds?", 
                description: "Whether families with 17-year-olds can receive the credit",
                current: "No", 
                key: "include17" 
            },
            { 
                name: "Young Child Bonus Enabled", 
                description: "Whether families get extra support for young children",
                current: "No", 
                key: "youngChildEnabled" 
            },
            { 
                name: "Young Child Bonus Age Range", 
                description: "Which ages qualify for the young child bonus",
                current: "N/A", 
                key: "youngChildAge" 
            },
            { 
                name: "Young Child Bonus Increment", 
                description: "How the bonus changes based on child's age",
                current: "N/A", 
                key: "youngChildIncrement" 
            },
            { 
                name: "Young Child Bonus Value ($)", 
                description: "Dollar amount of the young child bonus",
                current: "N/A", 
                key: "youngChildValue" 
            },
            { 
                name: "Young Child Bonus Value (%)", 
                description: "Percentage increase for young children",
                current: "N/A", 
                key: "youngChildPercent" 
            },
            { 
                name: "Infant Bonus Enabled", 
                description: "Whether families get extra help for babies under 1",
                current: "No", 
                key: "infantEnabled" 
            },
            { 
                name: "Infant Bonus Value", 
                description: "Extra amount provided for infants",
                current: "N/A", 
                key: "infantValue" 
            },
            { 
                name: "Minimum Earnings Requirement", 
                description: "How much parents must earn to qualify for the credit",
                current: "$2,500", 
                key: "minEarnings" 
            },
            { 
                name: "Phase-In Rate", 
                description: "How quickly low earners get the full credit as income rises",
                current: "15%", 
                key: "phaseInRate" 
            },
            { 
                name: "Phase-In Method", 
                description: "Whether credit increases per child or per family",
                current: "Per Family", 
                key: "phaseInMethod" 
            },
            { 
                name: "Phase-out Income Threshold (Single Head of Household)", 
                description: "Income level where benefits start decreasing for single parents",
                current: "$200,000", 
                key: "phaseOutSingle" 
            },
            { 
                name: "Phase-out Income Threshold (Married Filing Jointly)", 
                description: "Income level where benefits start decreasing for married couples",
                current: "$400,000", 
                key: "phaseOutMarried" 
            },
            { 
                name: "Phase-Out Rate", 
                description: "How quickly benefits decrease for higher earners",
                current: "5%", 
                key: "phaseOutRate" 
            }
        ];

        const exampleTags = document.querySelectorAll('.example-tag');
        const scenarioCards = document.querySelectorAll('.scenario-card');
        const queryInput = document.getElementById('policyQuery');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const loadingSection = document.getElementById('loadingSection');
        const resultsSection = document.getElementById('resultsSection');

        let selectedGoals = new Set();
        let currentMode = 'single';

        function switchMode(mode) {
            currentMode = mode;
            
            // Update mode buttons
            document.getElementById('singleGoalMode').classList.toggle('active', mode === 'single');
            document.getElementById('comprehensiveMode').classList.toggle('active', mode === 'comprehensive');
            
            // Show/hide sections
            document.getElementById('singleModeSection').classList.toggle('hidden', mode !== 'single');
            document.getElementById('comprehensiveModeSection').classList.toggle('hidden', mode !== 'comprehensive');
            
            // Hide results when switching modes
            resultsSection.classList.add('hidden');
        }

        function toggleGoal(card) {
            const goal = card.dataset.goal;
            
            if (selectedGoals.has(goal)) {
                selectedGoals.delete(goal);
                card.classList.remove('selected');
            } else {
                selectedGoals.add(goal);
                card.classList.add('selected');
            }
            
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const count = selectedGoals.size;
            document.getElementById('selectedCount').textContent = count;
            document.getElementById('buildPolicyBtn').disabled = count === 0;
        }

        function clearAllSelections() {
            selectedGoals.clear();
            document.querySelectorAll('.goal-card').forEach(card => {
                card.classList.remove('selected');
            });
            updateSelectedCount();
        }

        const goalDescriptions = {
            'newborns': 'Provide an extra $1,000 bonus for families with infants under 1 year old',
            'increase-base': 'Increase the base credit from $2,200 to $3,000 per child to keep up with inflation and rising costs',
            'low-income': 'Make the full credit available to low-income families by removing the minimum earnings requirement and making it fully refundable',
            'young-children': 'Provide an extra $600 for families with children under age 6 to help with childcare and early education costs',
            'seventeen': 'Extend the credit to include 17-year-olds so families get support through high school',
            'middle-class': 'Adjust phase-out thresholds to $150,000 for single parents and $300,000 for married couples to better target middle-class families'
        };

        async function buildComprehensivePolicy() {
            if (selectedGoals.size === 0) return;

            // Build combined query
            const goals = Array.from(selectedGoals).map(goal => goalDescriptions[goal]);
            const combinedQuery = `Create a comprehensive Child Tax Credit policy that achieves ALL of these goals: ${goals.join('; ')}`;

            await analyzeComprehensiveQuery(combinedQuery);
        }

        async function analyzeComprehensiveCustom() {
            const query = document.getElementById('comprehensiveQuery').value.trim();
            if (!query) return;

            await analyzeComprehensiveQuery(query);
        }

        async function analyzeComprehensiveQuery(query) {
            analyzeBtn.disabled = true;
            loadingSection.classList.remove('hidden');
            resultsSection.classList.add('hidden');

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1500,
                        messages: [{
                            role: 'user',
                            content: `You are a policy analysis assistant helping create a comprehensive Child Tax Credit policy that achieves multiple goals simultaneously.

User's Combined Goals: "${query}"

Current Child Tax Credit Policy (2026 Fiscal Year - One Big Beautiful Bill Act):
- Families receive up to $2,200 per child under age 17 (increased from $2,000)
- Up to $1,700 is refundable (can be received even if no taxes owed)
- Benefits phase out starting at $200K for single parents, $400K for married couples
- Families must earn at least $2,500 to qualify
- Both parent and child must have valid Social Security Numbers
- Credit amount indexed to inflation starting 2026

Available Policy Adjustments:
- maxCredit: Maximum amount per child (current: $2,200)
- maxRefundable: Maximum refundable portion (current: $1,700)
- include17: Include 17-year-olds (current: No)
- youngChildEnabled: Enable bonus for young children (current: No)
- youngChildAge: Age range for young child bonus (e.g., "Under 6")
- youngChildValue: Dollar amount of young child bonus
- infantEnabled: Enable bonus for infants (current: No)
- infantValue: Dollar amount of infant bonus
- minEarnings: Minimum income required (current: $2,500)
- phaseInRate: How fast credit grows with income (current: 15%)
- phaseOutSingle: When benefits start reducing for single parents (current: $200,000)
- phaseOutMarried: When benefits start reducing for married couples (current: $400,000)

Respond ONLY with a JSON object:
{
  "interpretation": "A 2-3 sentence overview of this comprehensive policy package and its overall approach to strengthening the CTC",
  "strength": "A 1-2 sentence statement about the strength/ambition of this combined policy (e.g., 'This represents a major expansion that would significantly increase support' or 'This creates a universal child benefit')",
  "goalsAchieved": [
    "Brief description of how each selected goal is addressed"
  ],
  "impacts": [
    "Concrete example of total benefit (e.g., 'A middle-class family with a newborn and a 5-year-old would receive $4,600 total')",
    "Another example showing cumulative effects"
  ],
  "changes": {
    "leverKey1": "newValue1",
    "leverKey2": "newValue2"
  }
}

Create a cohesive policy that integrates all requested goals. Use realistic values based on similar proposals. The changes should work together harmoniously.`
                        }]
                    })
                });

                const data = await response.json();
                const text = data.content.find(item => item.type === 'text')?.text || '';
                
                const jsonMatch = text.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    const result = JSON.parse(jsonMatch[0]);
                    result.isComprehensive = true;
                    result.selectedGoals = Array.from(selectedGoals);
                    currentResults = result;
                    displayResults(result);
                } else {
                    throw new Error('Could not parse AI response');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('There was an error building your policy. Please try again.');
            } finally {
                analyzeBtn.disabled = false;
                loadingSection.classList.add('hidden');
            }
        }

        scenarioCards.forEach(card => {
            card.addEventListener('click', () => {
                queryInput.value = card.dataset.query;
                analyzePolicy();
            });
        });

        exampleTags.forEach(tag => {
            tag.addEventListener('click', () => {
                queryInput.value = tag.dataset.query;
                analyzePolicy();
            });
        });

        analyzeBtn.addEventListener('click', analyzePolicy);
        queryInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                analyzePolicy();
            }
        });

        async function analyzePolicy() {
            const query = queryInput.value.trim();
            if (!query) return;

            analyzeBtn.disabled = true;
            loadingSection.classList.remove('hidden');
            resultsSection.classList.add('hidden');

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [{
                            role: 'user',
                            content: `You are a policy analysis assistant helping everyday people understand how the Child Tax Credit could be changed to achieve their goals.

Policy Goal from User: "${query}"

Current Child Tax Credit Policy (2026 Fiscal Year - One Big Beautiful Bill Act):
- Families receive up to $2,200 per child under age 17 (increased from $2,000)
- Up to $1,700 is refundable (can be received even if no taxes owed)
- Benefits phase out starting at $200K for single parents, $400K for married couples
- Families must earn at least $2,500 to qualify
- Both parent and child must have valid Social Security Numbers
- Credit amount indexed to inflation starting 2026

Available Policy Adjustments:
- maxCredit: Maximum amount per child (current: $2,200)
- maxRefundable: Maximum refundable portion (current: $1,700)
- include17: Include 17-year-olds (current: No)
- youngChildEnabled: Enable bonus for young children (current: No)
- youngChildAge: Age range for young child bonus (e.g., "Under 6")
- youngChildValue: Dollar amount of young child bonus
- infantEnabled: Enable bonus for infants (current: No)
- infantValue: Dollar amount of infant bonus
- minEarnings: Minimum income required (current: $2,500)
- phaseInRate: How fast credit grows with income (current: 15%)
- phaseOutSingle: When benefits start reducing for single parents (current: $200,000)
- phaseOutMarried: When benefits start reducing for married couples (current: $400,000)

Respond ONLY with a JSON object:
{
  "interpretation": "A 2-3 sentence explanation in plain language about what changes you're making and WHO this helps (e.g., 'families with newborns', 'low-income working families', 'middle-class parents'). Focus on outcomes, not technical policy terms.",
  "impacts": [
    "One specific, relatable impact (e.g., 'A family with a newborn would receive an extra $1,000')",
    "Another concrete example of who benefits"
  ],
  "changes": {
    "leverKey1": "newValue1",
    "leverKey2": "newValue2"
  }
}

Be specific with values. Use realistic amounts based on similar policy proposals. For bonuses, suggest $500-$1,500 amounts. Only change levers directly related to the user's goal.`
                        }]
                    })
                });

                const data = await response.json();
                const text = data.content.find(item => item.type === 'text')?.text || '';
                
                // Extract JSON from the response
                const jsonMatch = text.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    const result = JSON.parse(jsonMatch[0]);
                    currentResults = result;
                    displayResults(result);
                } else {
                    throw new Error('Could not parse AI response');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('There was an error analyzing your policy. Please try again.');
            } finally {
                analyzeBtn.disabled = false;
                loadingSection.classList.add('hidden');
            }
        }

        function displayResults(result) {
            // Show/hide comprehensive policy sections
            const isComprehensive = result.isComprehensive || false;
            
            if (isComprehensive) {
                document.getElementById('strengthIndicator').classList.remove('hidden');
                document.getElementById('strengthText').textContent = result.strength || '';
                
                document.getElementById('combinedGoalsSection').classList.remove('hidden');
                const goalsList = document.getElementById('combinedGoalsList');
                goalsList.innerHTML = '';
                (result.goalsAchieved || []).forEach(goal => {
                    const li = document.createElement('li');
                    li.textContent = goal;
                    goalsList.appendChild(li);
                });
            } else {
                document.getElementById('strengthIndicator').classList.add('hidden');
                document.getElementById('combinedGoalsSection').classList.add('hidden');
            }

            // Display interpretation
            document.getElementById('interpretationText').textContent = result.interpretation;

            // Display impacts if available
            const impactSection = document.getElementById('impactSection');
            if (result.impacts && result.impacts.length > 0) {
                const impactList = document.getElementById('impactList');
                impactList.innerHTML = '';
                result.impacts.forEach(impact => {
                    const div = document.createElement('div');
                    div.className = 'impact-item';
                    div.innerHTML = `
                        <span class="impact-icon">→</span>
                        <span class="impact-text">${impact}</span>
                    `;
                    impactList.appendChild(div);
                });
                impactSection.classList.remove('hidden');
            } else {
                impactSection.classList.add('hidden');
            }

            // Display changed levers summary
            const changedLeversList = document.getElementById('changedLeversList');
            changedLeversList.innerHTML = '';
            
            const changedCount = Object.keys(result.changes).length;
            document.getElementById('changedCount').textContent = changedCount;
            
            Object.keys(result.changes).forEach(key => {
                const lever = policyLevers.find(l => l.key === key);
                if (lever) {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span class="lever-label">${lever.name}:</span>
                        <span class="lever-change"> ${lever.current} → ${result.changes[key]}</span>
                    `;
                    changedLeversList.appendChild(li);
                }
            });

            // Build comparison table
            const tableBody = document.getElementById('comparisonTableBody');
            tableBody.innerHTML = '';

            // Filter to show only changed levers initially
            let leversToShow = showOnlyChanges ? 
                policyLevers.filter(lever => result.changes[lever.key] !== undefined) :
                policyLevers;

            leversToShow.forEach(lever => {
                const tr = document.createElement('tr');
                const hasChange = result.changes[lever.key] !== undefined;
                
                if (hasChange) {
                    tr.classList.add('changed');
                }

                tr.innerHTML = `
                    <td>
                        <div class="lever-name">
                            ${lever.name}
                            ${hasChange ? '<span class="change-indicator">CHANGED</span>' : ''}
                        </div>
                        <div class="lever-description">${lever.description}</div>
                    </td>
                    <td class="value-current">${lever.current}</td>
                    <td class="value-new">${hasChange ? result.changes[lever.key] : lever.current}</td>
                `;
                
                tableBody.appendChild(tr);
            });

            resultsSection.classList.remove('hidden');
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        let showOnlyChanges = true;
        let currentResults = null;
        let currentFilingStatus = 'single';
        let structureVisible = false;

        const creditConfig = {
            single: {
                phaseInStart: 2500,
                phaseInEnd: 17167,
                maxCredit: 2200,
                phaseOutStart: 200000,
                phaseOutEnd: 244000,
                maxIncome: 260000
            },
            married: {
                phaseInStart: 2500,
                phaseInEnd: 17167,
                maxCredit: 2200,
                phaseOutStart: 400000,
                phaseOutEnd: 444000,
                maxIncome: 460000
            }
        };

        function toggleCreditStructure() {
            const section = document.getElementById('creditStructureSection');
            const btn = document.querySelector('.show-structure-btn');
            const btnText = document.getElementById('structureBtnText');
            
            structureVisible = !structureVisible;
            
            if (structureVisible) {
                section.classList.remove('hidden');
                section.classList.add('visible');
                btn.classList.add('open');
                btnText.textContent = 'Hide Credit Structure';
                
                // Draw graph after section is visible
                setTimeout(() => drawGraph('single'), 100);
            } else {
                section.classList.remove('visible');
                section.classList.add('hidden');
                btn.classList.remove('open');
                btnText.textContent = 'See What the Credit Looks Like in Current Practice';
            }
        }

        function calculateCredit(income, status) {
            const c = creditConfig[status];
            
            if (income < c.phaseInStart) return 0;
            
            if (income < c.phaseInEnd) {
                return (income - c.phaseInStart) * 0.15;
            }
            
            if (income < c.phaseOutStart) {
                return c.maxCredit;
            }
            
            if (income < c.phaseOutEnd) {
                const reduction = (income - c.phaseOutStart) * 0.05;
                return Math.max(0, c.maxCredit - reduction);
            }
            
            return 0;
        }

        function formatCurrency(value) {
            if (value >= 1000) {
                return '$' + (value / 1000).toFixed(0) + 'K';
            }
            return '$' + value.toFixed(0);
        }

        function drawGraph(status) {
            const svg = document.getElementById('creditGraph');
            if (!svg) return;
            
            svg.innerHTML = '';
            
            const c = creditConfig[status];
            const width = 1000;
            const height = 400;
            const margin = { top: 20, right: 40, bottom: 60, left: 80 };
            const chartWidth = width - margin.left - margin.right;
            const chartHeight = height - margin.top - margin.bottom;

            const xScale = (income) => margin.left + (income / c.maxIncome) * chartWidth;
            const yScale = (credit) => height - margin.bottom - (credit / c.maxCredit) * chartHeight;

            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');

            // Draw zones
            const phaseInRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            phaseInRect.setAttribute('x', xScale(c.phaseInStart));
            phaseInRect.setAttribute('y', margin.top);
            phaseInRect.setAttribute('width', xScale(c.phaseInEnd) - xScale(c.phaseInStart));
            phaseInRect.setAttribute('height', chartHeight);
            phaseInRect.setAttribute('class', 'phase-in-zone');
            g.appendChild(phaseInRect);

            const maxCreditRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            maxCreditRect.setAttribute('x', xScale(c.phaseInEnd));
            maxCreditRect.setAttribute('y', margin.top);
            maxCreditRect.setAttribute('width', xScale(c.phaseOutStart) - xScale(c.phaseInEnd));
            maxCreditRect.setAttribute('height', chartHeight);
            maxCreditRect.setAttribute('class', 'max-credit-zone');
            g.appendChild(maxCreditRect);

            const phaseOutRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            phaseOutRect.setAttribute('x', xScale(c.phaseOutStart));
            phaseOutRect.setAttribute('y', margin.top);
            phaseOutRect.setAttribute('width', xScale(c.phaseOutEnd) - xScale(c.phaseOutStart));
            phaseOutRect.setAttribute('height', chartHeight);
            phaseOutRect.setAttribute('class', 'phase-out-zone');
            g.appendChild(phaseOutRect);

            // Draw axes
            const xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            xAxis.setAttribute('x1', margin.left);
            xAxis.setAttribute('y1', height - margin.bottom);
            xAxis.setAttribute('x2', width - margin.right);
            xAxis.setAttribute('y2', height - margin.bottom);
            xAxis.setAttribute('stroke', '#9ca3af');
            xAxis.setAttribute('stroke-width', '2');
            g.appendChild(xAxis);

            const yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            yAxis.setAttribute('x1', margin.left);
            yAxis.setAttribute('y1', margin.top);
            yAxis.setAttribute('x2', margin.left);
            yAxis.setAttribute('y2', height - margin.bottom);
            yAxis.setAttribute('stroke', '#9ca3af');
            yAxis.setAttribute('stroke-width', '2');
            g.appendChild(yAxis);

            // X-axis labels
            const xLabels = [0, 50000, 100000, 150000, 200000, c.phaseOutStart, c.maxIncome];
            xLabels.forEach(income => {
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', xScale(income));
                label.setAttribute('y', height - margin.bottom + 25);
                label.setAttribute('text-anchor', 'middle');
                label.setAttribute('class', 'axis-label');
                label.textContent = formatCurrency(income);
                g.appendChild(label);

                const tick = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                tick.setAttribute('x1', xScale(income));
                tick.setAttribute('y1', height - margin.bottom);
                tick.setAttribute('x2', xScale(income));
                tick.setAttribute('y2', height - margin.bottom + 5);
                tick.setAttribute('stroke', '#9ca3af');
                tick.setAttribute('stroke-width', '2');
                g.appendChild(tick);
            });

            // Y-axis labels
            const yLabels = [0, 500, 1000, 1500, 2000, 2200];
            yLabels.forEach(credit => {
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', margin.left - 15);
                label.setAttribute('y', yScale(credit) + 5);
                label.setAttribute('text-anchor', 'end');
                label.setAttribute('class', 'axis-label');
                label.textContent = formatCurrency(credit);
                g.appendChild(label);

                const tick = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                tick.setAttribute('x1', margin.left - 5);
                tick.setAttribute('y1', yScale(credit));
                tick.setAttribute('x2', margin.left);
                tick.setAttribute('y2', yScale(credit));
                tick.setAttribute('stroke', '#9ca3af');
                tick.setAttribute('stroke-width', '2');
                g.appendChild(tick);
            });

            // Axis titles
            const xAxisTitle = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            xAxisTitle.setAttribute('x', width / 2);
            xAxisTitle.setAttribute('y', height - 10);
            xAxisTitle.setAttribute('text-anchor', 'middle');
            xAxisTitle.setAttribute('class', 'axis-title');
            xAxisTitle.textContent = 'Family Income';
            g.appendChild(xAxisTitle);

            const yAxisTitle = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            yAxisTitle.setAttribute('x', -height / 2);
            yAxisTitle.setAttribute('y', 20);
            yAxisTitle.setAttribute('text-anchor', 'middle');
            yAxisTitle.setAttribute('transform', `rotate(-90, 20, ${height / 2})`);
            yAxisTitle.setAttribute('class', 'axis-title');
            yAxisTitle.textContent = 'Credit Amount per Child';
            g.appendChild(yAxisTitle);

            // Draw credit line
            const points = [];
            for (let income = 0; income <= c.maxIncome; income += 1000) {
                const credit = calculateCredit(income, status);
                points.push(`${xScale(income)},${yScale(credit)}`);
            }

            const creditLine = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');
            creditLine.setAttribute('points', points.join(' '));
            creditLine.setAttribute('class', 'credit-line');
            g.appendChild(creditLine);

            // Add zone labels
            const addZoneLabel = (text, x, y) => {
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', x);
                label.setAttribute('y', y);
                label.setAttribute('text-anchor', 'middle');
                label.setAttribute('fill', '#6b7280');
                label.setAttribute('font-size', '14');
                label.setAttribute('font-weight', '600');
                label.textContent = text;
                g.appendChild(label);
            };

            addZoneLabel('Phase-In', (xScale(c.phaseInStart) + xScale(c.phaseInEnd)) / 2, 45);
            addZoneLabel('Maximum Credit', (xScale(c.phaseInEnd) + xScale(c.phaseOutStart)) / 2, 45);
            addZoneLabel('Phase-Out', (xScale(c.phaseOutStart) + xScale(c.phaseOutEnd)) / 2, 45);

            svg.appendChild(g);
        }

        function showFilingStatus(status) {
            currentFilingStatus = status;
            
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            drawGraph(status);
        }

        function toggleView(showChangesOnly) {
            showOnlyChanges = showChangesOnly;
            
            // Update button states
            document.getElementById('changesOnlyBtn').classList.toggle('active', showChangesOnly);
            document.getElementById('allLeversBtn').classList.toggle('active', !showChangesOnly);
            
            // Redisplay results with new filter
            if (currentResults) {
                displayResults(currentResults);
            }
        }
    </script>
</body>
</html>